<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>

  <head>
    <script type="text/javascript">
    !function(T,l,y){var S=T.location,u="script",k="instrumentationKey",D="ingestionendpoint",C="disableExceptionTracking",E="ai.device.",I="toLowerCase",b="crossOrigin",w="POST",e="appInsightsSDK",t=y.name||"appInsights";(y.name||T[e])&&(T[e]=t);var n=T[t]||function(d){var g=!1,f=!1,m={initialize:!0,queue:[],sv:"4",version:2,config:d};function v(e,t){var n={},a="Browser";return n[E+"id"]=a[I](),n[E+"type"]=a,n["ai.operation.name"]=S&&S.pathname||"_unknown_",n["ai.internal.sdkVersion"]="javascript:snippet_"+(m.sv||m.version),{time:function(){var e=new Date;function t(e){var t=""+e;return 1===t.length&&(t="0"+t),t}return e.getUTCFullYear()+"-"+t(1+e.getUTCMonth())+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"."+((e.getUTCMilliseconds()/1e3).toFixed(3)+"").slice(2,5)+"Z"}(),iKey:e,name:"Microsoft.ApplicationInsights."+e.replace(/-/g,"")+"."+t,sampleRate:100,tags:n,data:{baseData:{ver:2}}}}var h=d.url||y.src;if(h){function a(e){var t,n,a,i,r,o,s,c,p,l,u;g=!0,m.queue=[],f||(f=!0,t=h,s=function(){var e={},t=d.connectionString;if(t)for(var n=t.split(";"),a=0;a<n.length;a++){var i=n[a].split("=");2===i.length&&(e[i[0][I]()]=i[1])}if(!e[D]){var r=e.endpointsuffix,o=r?e.location:null;e[D]="https://"+(o?o+".":"")+"dc."+(r||"services.visualstudio.com")}return e}(),c=s[k]||d[k]||"",p=s[D],l=p?p+"/v2/track":config.endpointUrl,(u=[]).push((n="SDK LOAD Failure: Failed to load Application Insights SDK script (See stack for details)",a=t,i=l,(o=(r=v(c,"Exception")).data).baseType="ExceptionData",o.baseData.exceptions=[{typeName:"SDKLoadFailed",message:n.replace(/\./g,"-"),hasFullStack:!1,stack:n+"\nSnippet failed to load ["+a+"] -- Telemetry is disabled\nHelp Link: https://go.microsoft.com/fwlink/?linkid=2128109\nHost: "+(S&&S.pathname||"_unknown_")+"\nEndpoint: "+i,parsedStack:[]}],r)),u.push(function(e,t,n,a){var i=v(c,"Message"),r=i.data;r.baseType="MessageData";var o=r.baseData;return o.message='AI (Internal): 99 message:"'+("SDK LOAD Failure: Failed to load Application Insights SDK script (See stack for details) ("+n+")").replace(/\"/g,"")+'"',o.properties={endpoint:a},i}(0,0,t,l)),function(e,t){if(JSON){var n=T.fetch;if(n&&!y.useXhr)n(t,{method:w,body:JSON.stringify(e),mode:"cors"});else if(XMLHttpRequest){var a=new XMLHttpRequest;a.open(w,t),a.setRequestHeader("Content-type","application/json"),a.send(JSON.stringify(e))}}}(u,l))}function i(e,t){f||setTimeout(function(){!t&&m.core||a()},500)}var e=function(){var n=l.createElement(u);n.src=h;var e=y[b];return!e&&""!==e||"undefined"==n[b]||(n[b]=e),n.onload=i,n.onerror=a,n.onreadystatechange=function(e,t){"loaded"!==n.readyState&&"complete"!==n.readyState||i(0,t)},n}();y.ld<0?l.getElementsByTagName("head")[0].appendChild(e):setTimeout(function(){l.getElementsByTagName(u)[0].parentNode.appendChild(e)},y.ld||0)}try{m.cookie=l.cookie}catch(p){}function t(e){for(;e.length;)!function(t){m[t]=function(){var e=arguments;g||m.queue.push(function(){m[t].apply(m,e)})}}(e.pop())}var n="track",r="TrackPage",o="TrackEvent";t([n+"Event",n+"PageView",n+"Exception",n+"Trace",n+"DependencyData",n+"Metric",n+"PageViewPerformance","start"+r,"stop"+r,"start"+o,"stop"+o,"addTelemetryInitializer","setAuthenticatedUserContext","clearAuthenticatedUserContext","flush"]),m.SeverityLevel={Verbose:0,Information:1,Warning:2,Error:3,Critical:4};var s=(d.extensionConfig||{}).ApplicationInsightsAnalytics||{};if(!0!==d[C]&&!0!==s[C]){method="onerror",t(["_"+method]);var c=T[method];T[method]=function(e,t,n,a,i){var r=c&&c(e,t,n,a,i);return!0!==r&&m["_"+method]({message:e,url:t,lineNumber:n,columnNumber:a,error:i}),r},d.autoExceptionInstrumented=!0}return m}(y.cfg);(T[t]=n).queue&&0===n.queue.length&&n.trackPageView({})}(window,document,{
    src: "https://az416426.vo.msecnd.net/scripts/b/ai.2.min.js",
    cfg: {
        instrumentationKey: "b0b411e6-3e51-4578-b762-608bb183d4a6"
    }});
    var telemetryInitializer = (envelope) => {
      envelope.data.someField = 'This item passed through my telemetry initializer';
    };
    appInsights.addTelemetryInitializer(telemetryInitializer);
    appInsights.trackTrace({message: 'This message will use a telemetry initializer'});
    var id = null;
    fetch('/.auth/me').then(function(response){
      return response.json();
    }).then(function(data){
      id = data[0].user_id;
      appInsights.setAuthenticatedUserContext(id);
    });
    </script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Module 2: Dynamic application security testing using OWASP ZAP | DevOps Dojo </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Module 2: Dynamic application security testing using OWASP ZAP | DevOps Dojo ">
    <meta name="generator" content="docfx ">
  
    <link rel="shortcut icon" href="../../../../../../favicon.ico">
    <link rel="stylesheet" href="../../../../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../../../../toc.html">
    <meta property="docfx:tocrel" content="../../../../../toc.html">
  
  
  
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>

        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../../../../../../index.html">
                <div class="msft-logo"></div>
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>

        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">

        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">

<p><strong><a href="index.html">Home</a> | <a href="module1.html">Module 1</a> | <a href="module2.html">Module 2</a> | <a href="module3.html">Module 3</a></strong></p>
<h1 id="module-2-dynamic-application-security-testing-using-owasp-zap"><strong>Module 2: Dynamic application security testing using OWASP ZAP</strong></h1>
<hr>
<p>In this module, you will deep dive into Dynamic Application Security Testing using OWASP ZAP. You will add the job in the code and see the scans running in every environment. Before you get started, let's understand what is Dynamic Application Security Testing and how OWASP ZAP helps.</p>
<p><a href="https://docs.microsoft.com/en-us/azure/security/develop/secure-develop#test-your-application-in-an-operating-state">Dynamic Application Security Testing (DAST)</a> is a process of testing an application in an operating state to find security vulnerabilities. DAST tools analyze programs while they are executing to find security vulnerabilities such as memory corruption, insecure server configurations, cross-site scripting, user privilege issues, SQL injections, and other critical security concerns.</p>
<p><a href="https://www.zaproxy.org/">OWASP ZAP</a>: Zed Attack Proxy (ZAP) is a free, open-source penetration testing tool being maintained under the umbrella of the Open Web Application Security Project (OWASP). ZAP is designed specifically to test web applications, and it is both flexible and extensible.</p>
<p>At its core, ZAP is what is known as a “man-in-the-middle proxy.” It stands between the client’s browser and the web application so that it intercepts and inspects messages sent between browser and web application, tamper the contents if needed, and then forward those packets on to the destination. It can be used as a stand-alone application, and as a daemon process.</p>
<p>In this module, you will also deep dive into Security Verification Tests for Azure using Secure DevOps kit for Azure (AzSK). Before you get started, let's understand what is AzSk.</p>
<p><a href="https://docs.microsoft.com/en-us/azure/security/develop/secure-develop#test-your-application-in-an-operating-state">Secure DevOps kit for Azure (AzSK)</a> is a collection of scripts, tools, extensions, automation, etc. that caters the end-to-end security needs in Azure, using extensive automation and frictionless integrations of security into the DevOps workflows. Usually, you are concerned about two things when it comes to security in Azure.</p>
<hr>
<h2 id="exercise-1-enable-owasp-zap-and-azsk-scans">Exercise 1: Enable OWASP ZAP and AzSK scans</h2>
<hr>
<p>In this exercise, we will enable the OWASP ZAP scan in Coupons repo.</p>
<ol>
<li><p>In the GitHub instance, navigate to the Coupons repo depending on your team allocation.</p>
</li>
<li><p>Go to the assigned repository based on step 1 above and open the GitHub Codespaces if you have one already created. If not, go ahead and select + New codespace.</p>
<p><img src="../../media/OWASP_ZAP_Part1.gif" alt="Open Codescpaces"></p>
</li>
<li><p>Create a new branch from <code>main</code> using <code>user/{user_id}/{purpose}</code> type of schema.</p>
<p><img src="../../media/OWASP_ZAP_Part2.gif" alt="Create new branch"></p>
</li>
<li><p>Open the <code>/.github/workflows/environment-template.yml</code> file. Search for <code>AZSK_OWASP_Scan</code> job. Uncomment that block to enable the AZSK_OWASP_Scan stage. You can use shortcut <code>Ctrl + k + u</code> to uncomment and <code>Ctrl + k + c</code> to comment out a block of code.</p>
</li>
<li><p>Now open the <code>.github/actions/continuous-security/action.yml</code> file. This is the composite action that includes the set-up and execution of AzSK and OWASP tests. See how, as part of the action, we are first creating the Teams card for continuously collaborate.</p>
</li>
<li><p>Commit your changes and create a Pull Request.</p>
<p><img src="../../media/OWASP_ZAP_Part4.gif" alt="Raise pull request"></p>
</li>
<li><p>Link both, the commit and pull request, to the specific task in ADO by using the AB#{work_item_id} format. Put some meaningful description and put some reviewers from your team as shown below:</p>
<p><img src="../../../continuous-operations/media/create-pull-request.png" alt="Link work items"></p>
</li>
<li><p>Once the pull requests is approved and checks have been passed, you can merge the changes into the main branch. As part of this merge, the CI workflow will be triggered again. If successfully executed, then the CD workflow will be triggered afterwards. Monitor the progress of the workflow from Actions tab.</p>
</li>
<li><p>Take a look at the logs to see if the OWASP scan and AzSK checks are successfully executed.</p>
</li>
</ol>
<hr>
<h2 id="exercise-2-view-results-for-owasp-zap-scan">Exercise 2: View results for OWASP ZAP scan</h2>
<hr>
<p>In this exercise, we will view the results of the OWASP ZAP scan.</p>
<ol>
<li><p>In the repo, navigate to issues tab and here you will be able to see the results.</p>
</li>
<li><p>You can filter the issues by author field value <code>github-actions</code> bot. Once the filter is applied you will be able to see the results of the OWASP ZAP scan.</p>
<p><img src="../../media/OWASP_ZAP_Part5.gif" alt="View OWASP Scan results"></p>
</li>
<li><p>Click on issue to see the details. You will be able to see information including the web application URL, New alerts reported by OWASP ZAP.The link to download the scan report is also available towards the end of the issues listing.</p>
</li>
<li><p>Click on the link to download the report. This will take you to the Actions tab. Navigate to the Artifacts section and you can see the <strong>zap_scan</strong></p>
</li>
<li><p>Click on <strong>zap_scan</strong> and this will download the zip file. The zip file will have the scan report in HTML, JSON and MD file format. You can browse through the report to go through the issues reported and take appropriate actions based on recommended solutions to remediate the issues.</p>
<p><img src="../../media/OWASP_ZAP_Part6.gif" alt="View OWASP Scan results"></p>
</li>
</ol>
<hr>
<h2 id="exercise-3-view-results-for-azsk-scan">Exercise 3: View results for AzSk scan</h2>
<hr>
<p>In this exercise, we will view the results of the AzSk scan.</p>
<ol>
<li><p>In the repo, navigate to actions tab and here you will be able to see the workflows along with the status.</p>
</li>
<li><p>Select the <strong>Countinuous delivery</strong>  workflow and click on the recent run completed as part of exercise 1.</p>
</li>
<li><p>On the summary page, navigate to <strong>Artifacts</strong> section. You will be able to see the artifacts for the azsk scan named as <strong>&quot;azsk&quot;</strong>. Click on it and this will download a zip file to your local.</p>
</li>
<li><p>Open the zip file and you will be able to see the scan results exported in the form of an excel sheet.</p>
<p><img src="../../media/AzSK_Part1.gif" alt="View AzSk scan results"></p>
</li>
<li><p>AzSk scan results have 4 different types of status.</p>
<ul>
<li><p><strong>Passed</strong> : These are automated checks by AzSk that have passed, and you should be happy seeing this.</p>
</li>
<li><p><strong>Verify</strong> : For this type, look at the LOG file to get the supporting information that should help you to decide whether to consider the control as &quot;Passed&quot; or not.</p>
<p><em>e.g., For an RBAC control, you should look at the actual list of users and confirm that it is appropriate. Use the &quot;Control Attestation&quot; feature to record your attestation.</em></p>
</li>
<li><p><strong>Manual</strong> : For this type, follow the steps using the Recommendation field in the CSV.</p>
<p><em>There will not be anything in the LOG file for &quot;Manual&quot; controls.</em></p>
</li>
<li><p><strong>Failed</strong> : For this type, look at the LOG file and use the Recommendation field to address the issue.</p>
<p><em>e.g., If the 'external accounts (LiveId)' control has failed, the list of such external accounts found is displayed in the LOG file. Remove these using the cmdlet mentioned in the Recommendation field.</em></p>
</li>
</ul>
</li>
</ol>
<p>Depending on the status of the results, you can work on fixing the issues reported.</p>
<hr>
<h2 id="key-takeaways">Key takeaways</h2>
<hr>
<ul>
<li><p>ZAP sprawls your web application and constructs a map of your web applications’ pages and dependent resources. It records the requests and responses sent to each page, and creates alerts if there is potential issue with the request or response.</p>
</li>
<li><p>The OWASP ZAP results include issue description, along with CWE ID as well as recommended solutions to fix the issue.</p>
</li>
<li><p>The AzSK contains cmdlets that DevOps teams can use to regularly keep their cloud applications secure in various activities like prototyping, core solution development, integration and deployment. These scripts are called Security Verification Tests (SVTs) which cover all prominent features in Azure (e.g., Web Apps, Storage, SQL DB, Key Vault, etc.). Each SVT corresponds to a particular Azure feature or service, and automates checks for secure configuration and security best practices for that particular Azure service.</p>
</li>
<li><p>The AzSk results include issue description, status, resource group name, severity and recommendations to fix the issue.</p>
</li>
</ul>
<hr>
<h2 id="whats-next-">What's Next ?</h2>
<hr>
<p><a href="../../../continuous-operations/index.html">Continuous Operations</a></p>
</article>
          </div>

          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      <footer class="w-100 py-2">
          <div class="container my-2">
              <div class="hacker white"></div>
              <div class="hacker orange"></div>
              <div class="hacker green"></div>
              <div class="hacker black"></div>
              <div class="dojo-teams hidden-xs hidden-sm"></div>
          </div>
      </footer>    </div>

    <script type="text/javascript" src="../../../../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../../../../styles/main.js"></script>
  </body>
</html>
